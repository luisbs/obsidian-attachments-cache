# Settings

## FAQs

### About the domains

Specified domains are used to match against the URLs in the [frontmatter attributes](#notes-ignore-frontmatter-attribute--notes-cache-frontmatter-attribute) and the [CacheRule remotes](#cacherule-remotes).

The syntax used follows the next rules

- If a protocol is added the URL will be **hard-matched**, only `'http'` and `'https'` are accepted.
- If a protocol is omitted the URL will be **soft-matched**.
- When **soft-matched** any subdomain will be allowed.
- A path can be used for specificity.

Examples of the matching:

|     URL     | `example.org` (soft) | `https://example.org` (hard) |
|:----------- |:--------------------:|:----------------------------:|
| `https://example.org/image.jpg`      | ✅ | ✅ |
| `https://example.org/path/image.jpg` | ✅ | ✅ |
| `https://sub.example.org/image.jpg`  | ✅ | ⛔ |
|  `http://example.org/image.jpg`      | ✅ | ⛔ |
|  `http://example.org/path/image.jpg` | ✅ | ⛔ |


## General Settings

### `Log level`

By default **Log level** is set to `'WARN'` this prevents the package from over-logging into the user console.

Changing the **Log level** to `'INFO'` or `'DEBUG'` will print to the console valuable information of the inner-workings of the plugging, details about why an URL is/isn't cached, etc.

---

### `Cache priority`

The priority affects when the plugin will run in relation to other plugins, by default **Priority** is set to `'NORMAL'` or _**Cache majority of attachments**_.

> TLDR; if you detect some attachments ignoring cache, change the **Priority** to `'HIGHER'` or _**Cache all posible attachments**_

What this value relates too is the order of the [PostProcessors](https://docs.obsidian.md/Plugins/Editor/Markdown+post+processing), what happens is that in some cases other plugins may run with the same or higher `sortOrder` value than the **AttachmentsCache Plugin**.

The result of that is some attachments used by those plugins not been notice and avoiding been cached.

The posible values are:

#### Priority `'LOWER'` or _**Only cache static attachments**_

This mode will only try to cache attachments that are **part of the note content**, ex:

```md
![](https://images.example.net/image1.jpg)
```

But for example if a plugin renderes an image, the image may not be detected by the **AttachmentsCache Plugin**, and the cache will be ignored.

#### Priority `'NORMAL'` or _**Cache majority of attachments**_

This mode will expand `'LOWER'` and try to also cache attachments on views that other plugins generate.

In this case the above example of special elements been rendered will try to cache most plugins artifacts, but it may still not detect somo plugins that make their **PostProcessors** with higher `sortOrder` values.

#### Priority `'HIGHER'` or _**Cache all posible attachments**_

This mode will expand `'NORMAL'` and try to cache most attachments, it may only ignore elements generated by plugins that intentionally try to place there **PostProcessors** as the last ones.

### `Keep special characters`

When this setting is disabled any non-standard character is replaced with an underscore, to prevent problems on a paths.

---

## Overrides Settings

The next settings are the available ways to override the behavior of a **CacheRule** on an individual attachment or on a note.

The order of the overrides is the next one:

- `URL's ignore param`
- `URL's cache param`
- `Note's ignore frontmatter attribute`
- `Note's cache frontmatter attribute`
- If non of these overrides matches the normal **CacheRule** behavior will happen.

### `URL's ignore param` & `URL's cache param`

> This Settings work if the **Note** has already matched an _enabled **CacheRule**_.

Overrides standar **CacheRules** on a per-link basis, and caches/ignores the attachment.

Both **URL params** can be changed on the **Plugin Settings** by default they are `ignore_file` and `cache_file`, e.g.:

```md
<!-- ignores the next image -->
![](https://example.com/image1.jpg?ignore_file)
<!-- caches the next image -->
![](https://example.com/image2.jpg?cache_file)
```

### `Note's ignore frontmatter attribute` & `Note's cache frontmatter attribute`

> This Settings work if the **Note** has already matched an _enabled **CacheRule**_.

Overrides standar **CacheRules** on a per-note basis, and caches/ignores the note's attachments.

Both **Frontmatter attributes** can be changed on the **Plugin Settings** by default they are `cache_unless` and `cache_from`, e.g.:

```yml
# this params correspond to the Note's Frontmatter
# strings are supported
cache_unless: example.com/images
# arrays are also supported
cache_from: [example.com/photos, https://images.net/assets]
```

The syntax used can be seen in the [about the domains](#about-the-domains) section.

### `Note's CacheRule frontmatter attribute`

Makes the current note follow the behavior of the referenced **CacheRule**.

The used attribute name can be changed on the **Plugin Settings** by default is `cache_rule` e.g.:

```yml
# this params correspond to the Note's Frontmatter
# the identifier of the CacheRule should be used
cache_rule: identifier
```

---

## CacheRule configurations

The next settings can be changed on a per-**CacheRule** basis allowing to have different behaviors to store/ignore some vault paths or remote URLs.

### `Remove this rule?` or disable it

The **CacheRules** can be individually removed, but is recommend to just disable them since the removal can not be reversed.

### CacheRule `identifier`

> NOTE: this feature is not ready yet

The **CacheRules** identifier can be used to relate a note to a **CacheRule** even if the notepath does not matches the **CacheRule** pattern. e.g.:

````yml
# this param correspond to the Note's Frontmatter
cache_rule: images-rule
````

### CacheRule `storage`

By default, attachments are added next to the note.

You can change the attachment location dynamically. The input allows the usage of variables in the path. For example:

From the note `a/b/c/note1.md`, the next variables are available:

- `{notepath}` resolves `a/b/c/note1`
- `{notename}` resolves `note1`
- `{folderpath}` resolves `a/b/c`
- `{foldername}` resolves `c`

From the attachment been stored, the next variables are available:

- `{ext}` like `jpg`, `jpeg`, `pdf` or `mp3` (taken from the url)
<!-- TODO: add `{type}` user-defined extension groups, like `images = jpg,png` -->

Values equivalent to **_Obsidian.md_ standard attachment location setting** would be:

- `/`: **Vault folder** adds the attachments to the root of your vault.
- `attachments`: **In the folder specified below** adds the attachments to a specified folder.
- `{folderpath}`: **Same folder as current file** adds the attachments to the same folder as the note you added it to.
- `{folderpath}/attachments`: **In subfolder under current folder** adds attachments to a specified folder next to the note you added the attachment to. If it doesn't exist, it's created when you add an attachment.

Other supported examples are:

- `attachments/{notename}`: adds the attachments to the folder `attachments` under a folder with the note name.
- `attachments/{notepath}`: adds the attachments to the folder `attachments` under folders replicating the note path.

### CacheRule `pattern`

This **GLOB** pattern is used to match against the notes path, and check if the current **CacheRule** should be applied.

If you don't have much experience with globs, check [this  tool](https://www.digitalocean.com/community/tools/glob).

### CacheRule `remotes`

Defines the remotes URLs that should be cached/ignored. The syntax follows the next rules:

- **One** domain per line.
- `#` at the start of the line means comment. ***(TODO)***
- Start the line with `'w'` or `'b'` to **whitelist**/**blacklist** the domain.
- The syntax used for the domains can be seen in the [about the domains](#about-the-domains) section.

An example of a working list of remotes:

```txt
# accept urls from 4kwallpapers.com when they use 'https'
b https://4kwallpapers.com/images

# accept urls from 'pexels.com' only from the subdomain 'images'
w images.pexels.com

# accept urls only from an specific GitHub repository
w github.com/elementary/wallpapers
b github.com

# ignore all other urls (fallback behavior)
b *
```

The order is important, if a line is matched the proccess will not check against the remaining ones.

The default fallback behavior is to **ignore** the attachment.
